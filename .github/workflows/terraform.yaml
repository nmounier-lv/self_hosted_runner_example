name: NON_PROD

on:
  push:
    branches:
      - feature/*
  pull_request:
    # Sequence of patterns matched against refs/heads
    branches:
      - master
    types:
      - synchronize

jobs:
  # NPD
  plan_poc:
    uses: ./.github/workflows/plan.yaml
    with:
      environment: poc
  plan_dev:
    uses: ./.github/workflows/plan.yaml
    with:
      environment: dev
  plan_int:
    uses: ./.github/workflows/plan.yaml
    with:
      environment: int
  plan_prp:
    uses: ./.github/workflows/plan.yaml
    with:
      environment: prp
  apply_poc:
    uses: ./.github/workflows/apply.yaml
    needs: plan_poc
    with:
      environment: poc
  apply_dev:
    uses: ./.github/workflows/apply.yaml
    needs: plan_dev
    with:
      environment: dev
  apply_int:
    uses: ./.github/workflows/apply.yaml
    needs: plan_int
    with:
      environment: int
  apply_prp:
    uses: ./.github/workflows/apply.yaml
    needs: plan_prp
    with:
      environment: prp

  # PRD
  plan_prd:
    if: github.ref == 'refs/heads/master'
    uses: ./.github/workflows/plan.yaml
    with:
      environment: prd
  apply_prd:
    if: github.ref == 'refs/heads/master'
    uses: ./.github/workflows/apply.yaml
    needs: plan_prd
    with:
      environment: prd